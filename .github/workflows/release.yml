name: Release

on:
  push:
    branches: [main]

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - name: debug
        uses: hmarr/debug-action@v2
      - name: Checkout
        uses: actions/checkout@master
        with:
          fetch-depth: 0
      - name: update
        run: |
          git fetch --prune --unshallow
      - name: Get Previous tag
        id: previoustag
        uses: WyriHaximus/github-action-get-previous-tag@v1
        with:
          fallback: 0.0.1 # Optional fallback tag to use when no tag can be found
      - name: Get next minor version
        id: semvers
        uses: WyriHaximus/github-action-next-semvers@v1
        with:
          version: ${{ steps.previoustag.outputs.tag }}
      - run: echo "previous tag" ${{steps.previoustag.outputs.tag }}
      - run: echo "previous timestamp" ${{steps.previoustag.outputs.timestamp }}
      - run: echo ${{steps.semvers.outputs.major }}
      - run: echo ${{steps.semvers.outputs.minor }}
      - run: echo ${{steps.semvers.outputs.patch }}
      - run: echo ${{steps.semvers.outputs.v_major }}
      - run: echo ${{steps.semvers.outputs.v_minor }}
      - run: echo ${{steps.semvers.outputs.v_patch }}
      - name: 'Build Changelog'
        id: changelog
        uses: mikepenz/release-changelog-builder-action@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - run: echo "changelog "  ${{steps.changelog.outputs.changelog }}
      - run: echo "fromTag "    ${{steps.changelog.outputs.fromTag }}
      - run: echo "toTag "      ${{steps.changelog.outputs.toTag }}
